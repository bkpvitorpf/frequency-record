# Migration `20200929005250-fix`

This migration has been generated by vitor0p9f at 9/28/2020, 9:52:50 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Students" DROP CONSTRAINT "Students_id_usuario_fkey"

ALTER TABLE "public"."Teachers" DROP CONSTRAINT "Teachers_id_usuario_fkey"

ALTER TABLE "public"."Modes" ADD COLUMN "mattersIdentificador" text   

CREATE UNIQUE INDEX "Users.nome_id_usuario_unique" ON "public"."Users"("nome", "id_usuario")

ALTER TABLE "public"."Modes" ADD FOREIGN KEY ("mattersIdentificador")REFERENCES "public"."Matters"("identificador") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Students" ADD FOREIGN KEY ("id_usuario", "nome")REFERENCES "public"."Users"("id_usuario","nome") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Teachers" ADD FOREIGN KEY ("id_usuario", "nome")REFERENCES "public"."Users"("id_usuario","nome") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200929003857-fix..20200929005250-fix
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Info4{
   id_sensor Int @unique
@@ -47,20 +47,22 @@
   nome String
   email String @unique
   senha String
   nivel_de_permissao Int
+
+  @@unique([nome,id_usuario])
 }
 model Students{
   id_usuario Int 
-  nome String
+  nome String 
   matricula Int @unique
   id_sensor Int @unique
   id_modalidade Int
   id_curso Int
   id_turma Int
-  User Users @relation(fields: [id_usuario],references: [id_usuario])
+  User Users @relation(fields: [id_usuario,nome],references: [id_usuario,nome])
   Mode Modes @relation(fields: [id_modalidade],references: [id_modalidade])
   Course Courses @relation(fields: [id_curso],references: [id_curso])
   Class Classes @relation(fields: [id_turma],references: [id_turma])
 }
@@ -94,9 +96,9 @@
   materias String[]
   id_sensor_profesor Int @unique
   id_professor Int @default(autoincrement()) @id
-  User Users @relation(fields: [id_usuario],references: [id_usuario])
+  User Users @relation(fields: [id_usuario,nome],references: [id_usuario,nome])
 }
 model Classes{
   id_turma Int @default(autoincrement()) @id
```


